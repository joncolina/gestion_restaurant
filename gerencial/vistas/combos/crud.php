<?php
/*================================================================================
 *--------------------------------------------------------------------------------
 *
 *	CRUD DE PLATOS
 *
 *--------------------------------------------------------------------------------
================================================================================*/

/*================================================================================
 * Tomamos los parametros
================================================================================*/
 $accion = Input::POST("accion");
 $objRestaurant = Sesion::getRestaurant();
 $idRestaurant = $objRestaurant->getId();

/*================================================================================
 * 
================================================================================*/
switch($accion)
{
	/*============================================================================
	 * 
	 * 
	 * 
	============================================================================*/
	case "CONSULTAR":
		$buscar = Input::POST("buscar", FALSE);
		if($buscar === FALSE)
		{
			$combos = CombosModel::Listado( $idRestaurant );
        }
        else
        {
            $combos = CombosModel::Listado( $idRestaurant, $buscar );
		}

		$data = [];
		foreach($combos as $combo)
		{
			$objCombo = new ComboModel( $combo['idCombo'] );

			array_push($data, [
				"id" => $objCombo->getId(),
				"nombre" => $objCombo->getNombre(),
				"descuento" => $objCombo->getDescuento(),
				"activo" => $objCombo->getActivo(),
				"fecha_registro" => $objCombo->getFechaRegistro()
			]);
		}

		$respuesta['data'] = $data;
	break;

	/*============================================================================
	 * 
	 * 
	 * 
	============================================================================*/
    case "REGISTRAR":
        
	break;

	/*============================================================================
	 * 
	 * 
	 * 
	============================================================================*/
    case "MODIFICAR":
        
	break;

	/*============================================================================
	 * 
	 * 
	 * 
	============================================================================*/
    case "ELIMINAR":
		$idCombo = Input::POST("idCombo", TRUE);
		$objCombo = new ComboModel( $idCombo );

		if($objCombo->getIdRestaurant() != $idRestaurant) {
			throw new Exception("No puede eliminar combos de otros resturantes.");
		}

        $objCombo->Eliminar();
        Conexion::getMysql()->Commit();
    break;

	/*============================================================================
	 * 
	 * 
	 * 
	============================================================================*/
	default:
		throw new Exception("Acción No Válida");
	break;
}

/*================================================================================
 * 
================================================================================*/
echo json_encode($respuesta);